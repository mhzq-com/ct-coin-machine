<!DOCTYPE html>
<html lang="hu-HU">

<head>
    <title>CityMediaCoinMachine</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="Keywords" content="node,js,nodejs,home,automation,homeautomation,statisztika,automatizálás">
    <meta name="Description" content="CityMediaCoinMachine">
    <!--<link rel="icon" href="/favicon.ico" type="image/x-icon">-->
    <script src="js/jquery-3.2.1.min.js"></script>
    <link href="css/jquery-ui.min.css" type="text/css" rel="stylesheet">
    <link href="css/keyboard.css" type="text/css" rel="stylesheet">
    <link href="css/animate.css" type="text/css" rel="stylesheet">
    <link href="css/component.css" type="text/css" rel="stylesheet">
    <link href="css/bootstrap-reboot.min.css" type="text/css" rel="stylesheet">
    <link href="css/bootstrap.min.css" type="text/css" rel="stylesheet">
    <link href="css/site.css" type="text/css" rel="stylesheet">
    <link href="css/font-awesome/css/all.min.css" type="text/css" rel="stylesheet">


    <script src="js/jquery-ui.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.keyboard.min.js"></script>
    <script src="js/socket.io.min.js"></script>
    <script src="js/modernizr.custom.js"></script>
    <script src="js/jquery.dlmenu.js"></script>
    <script src="js/Chart.bundle.min.js"></script>
    <script src="js/site.js"></script>
    <script>
        //prevent right click
        //document.addEventListener('contextmenu', event => event.preventDefault());
        $(function () {


            socket.on('timeChange', function (data) { //get button status from client

                $(`#time`).html(data);
            });

            socket.on('coinCount', function (data) { //get button status from client
                alert(`Kidobott érmék darabszáma: ${data}`);
            });




            $("#logout").click(function (e) {
                e.preventDefault();
                $(this).addClass("loading");

                $.post("api/Logout", {}, function (data) {

                    window.location.href = "/login.html";

                }, "json").fail((xhr) => {
                    $("body").displayMessage({ message: xhr.responseJSON.error_description });
                }).always(() => {
                    $(this).removeClass("loading");
                });

            });

            $("#coinDropTest").on("click", function(e) {
                e.preventDefault();
                $(this).addClass("loading");

                $.post("api/TossACoinToYourWitcher", {}, function (data) {



                }, "json").fail((xhr) => {
                    $(this).closest(".card").displayMessage({ message: xhr.responseJSON.error_description });
                }).always(() => {
                    $(this).removeClass("loading");
                });

            });

            $("#emptyHopper").on("click", function(e) {
                e.preventDefault();

                if (!confirm("Biztosan üríted?")) {
                    return;
                }

                $(this).addClass("loading");

                $.post("api/EmptyHopper", {}, function (data) {

                    alert(`${data}`);

                }, "json").fail((xhr) => {
                    $(this).closest(".card").displayMessage({ message: xhr.responseJSON.error_description });
                }).always(() => {
                    $(this).removeClass("loading");
                });

            });

            $("#fillUp").on("click", function (e){
                e.preventDefault();
                console.log($(this).closest(".card").find("input[type=number]").val());
                var coinCount = parseInt($(this).closest(".card").find("input[type=number]").val())

                if(isNaN(coinCount)){
                    alert($(this).closest(".card").find("input[type=number]").val() + " nem egy szám");
                    return;
                }

                if (!confirm(`Biztosan feltölti ` + coinCount + ` darabszámmal?`)) {
                    return;
                }

                $(this).addClass("loading");

                $.post("api/FillUpHopper", {coinCount: coinCount}, function (data) {

                    alert(`Feltöltés utáni darabszám: ${data}`);

                }, "json").fail((xhr) => {
                    $(this).closest(".card").displayMessage({ message: xhr.responseJSON.error_description });
                }).always(() => {
                    $(this).removeClass("loading");
                });

            });

            $("#update").on("click", function (e){
                e.preventDefault();
                
                $(this).addClass("loading");

                $.post("api/UpdateApp", {}, function (data) {

                    alert(`Frissítés után a rendszert újra kell indítani ${data}`);

                }, "json").fail((xhr) => {
                    $(this).closest(".card").displayMessage({ message: xhr.responseJSON.error_description });
                }).always(() => {
                    $(this).removeClass("loading");
                });

            });

            $("#restart").on("click", function (e){
                e.preventDefault();
                
                $(this).addClass("loading");

                $.post("api/Restart", {}, function (data) {

                    alert(`Az eszköz 5mp múlva újraindul`);

                }, "json").fail((xhr) => {
                    $(this).closest(".card").displayMessage({ message: xhr.responseJSON.error_description });
                }).always(() => {
                    $(this).removeClass("loading");
                });

            });


        });
    </script>
</head>

<body>


    <div id="dl-menu" class="dl-menuwrapper">

        <button class="button dl-trigger dl-active"></button>

        <span>Menü</span>
        <ul class="dl-menu">
            <li>
                <a href="/settings.html">Beállítások</a>
            </li>
            <li>
                <a id="logout" href="#">Kijelentkezés</a>
            </li>

        </ul>
    </div>
    <div class="container-fluid">
        <div class="justify-content-center row">
            <div class="card m-3" style="width: 18rem;">

                <div class="card-body">
                    <h5 class="card-title">Infó</h5>
                    <p class="card-text">Sorozatszám: ${serialNumber}</p>
                    <p class="card-text">Érmék darabszáma: ${coinCount}</p>
                    <p class="card-text">Eladások: ${salesCount}</p>
                    <p class="card-text">Eladások: ${salesAfterLastFillUp}</p>
                    
                </div>
            </div>
            <div class="card m-3" style="width: 18rem;">

                <div class="card-body">
                    <h5 class="card-title">Érme kidobás teszt</h5>
                    <p class="card-text">Az érme kidobás teszttel fizetés nélkül ellenőrizhető, hogy az érme kidobódik
                    </p>
                    <button id="coinDropTest" class="btn btn-primary">Érme kidobás teszt</button>
                </div>
            </div>
            <div class="card m-3" style="width: 18rem;">

                <div class="card-body">
                    <h5 class="card-title">Ürítés</h5>
                    <p class="card-text">Ürítéssel a teljes tartalmat kidobja a gép, valamint megszámolja hány darab
                        volt benne.</p>
                    <button id="emptyHopper" class="btn btn-primary">Ürítés</button>
                </div>
            </div>
            <div class="card m-3" style="width: 18rem;">

                <div class="card-body">
                    <h5 class="card-title">Feltöltés</h5>
                    <p class="card-text">Feltöltheted érmékkel az eszközt</p>
                    <div class="form-group row">
                        <div class="input-group">
                            <input class="form-control" type="number" value="1" min="1" max="1000" step="1"/>
                            <div class="input-group-append">
                                <div class="input-group-text">
                                    db
                                </div>
                            </div>
                        </div>
                        
                    </div>
                    <button id="fillUp" class="btn btn-primary">Feltöltés</button>
                </div>
            </div>

            <div class="card m-3" style="width: 18rem;">

                <div class="card-body">
                    <h5 class="card-title">Rendszerfrissítés</h5>
                    <p class="card-text">Frissítheted az eszköz rendszerét ha van új csomag</p>
                    <div class="form-group row">
                        <div class="col-auto">Verzió:</div>
                        <div class="col">${version}</div>
                        
                    </div>
                    <button id="update" class="btn btn-primary">Frissítés</button>
                </div>
            </div>
            <div class="card m-3" style="width: 18rem;">

                <div class="card-body">
                    <h5 class="card-title">Újraindítás</h5>
                    <p class="card-text">Eszköz újraindítása</p>
                    
                    <button id="restart" class="btn btn-primary">Újraindítás</button>
                </div>
            </div>
        </div>
    </div>
</body>

</html>